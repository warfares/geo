/*
  geo-core.js 
  Copyright 2005-2010 :-), Inc., released under the Clear BSD  license.

  Includes compressed code under the following licenses:

  (For uncompressed versions of the code used please see the
  Geo-Core GIT repository: ...)
*/
ï»¿
Ext.ns("Geo");Geo.UriTemplate={group_static_bbox:'group/staticbbox',group_within_point:'group/withinpoint',group_within_bbox:'group/withinbbox',group_closest_point:'group/closestpoint',layer:'layer/',layer_query:'layer/query',getUri:function(action,option){return GEO_SERVICE+Geo.UriTemplate[action]+(option||'');}};Ext.ns("Geo.core");Geo.core.Group=Ext.extend(Ext.util.Observable,{constructor:function(config){this.addEvents('staticbbox','withinpoint','closestpoint');Geo.core.Group.superclass.constructor.call(config);},getStaticBBox:function(layers){var params={layers:layers};Ext.Ajax.request({url:Geo.UriTemplate.getUri('group_static_bbox'),method:'Post',headers:{'Content-Type':'text/json'},jsonData:params,scope:this,success:function(response,options){var result=Ext.util.JSON.decode(response.responseText);this.fireEvent('staticbbox',result);}});},getWithInPoint:function(layers,fields,point,dist){var params={layers:layers,fields:fields,point:point,dist:dist};Ext.Ajax.request({url:Geo.UriTemplate.getUri('group_within_point'),method:'Post',headers:{'Content-Type':'text/json'},jsonData:params,scope:this,success:function(response,options){var result=Ext.util.JSON.decode(response.responseText);this.fireEvent('withinpoint',result.geoms);}});},getClosestPoint:function(layers,point){var params={layers:layers,point:point};Ext.Ajax.request({url:Geo.UriTemplate.getUri('group_closest_point'),method:'Post',headers:{'Content-Type':'text/json'},jsonData:params,scope:this,success:function(response,options){var result=Ext.util.JSON.decode(response.responseText);this.fireEvent('closestpoint',result.points);}});}});Ext.ns("Geo.core");Geo.core.Layer=Ext.extend(Ext.util.Observable,{constructor:function(config){this.addEvents('query','metadata','bbox','staticbbox');Geo.core.Layer.superclass.constructor.call(config);},query:function(layer,fields,criteria){var params={layer:layer,fields:fields,criteria:criteria};Ext.Ajax.request({url:Geo.UriTemplate.getUri('layer_query'),method:'Post',headers:{'Content-Type':'text/json'},jsonData:params,scope:this,success:function(response,options){var result=Ext.util.JSON.decode(response.responseText);this.fireEvent('query',result);}});},getMetadata:function(layer){Ext.Ajax.request({url:Geo.UriTemplate.getUri('layer',layer+'/metadata'),method:'Get',headers:{'Content-Type':'text/json'},scope:this,success:function(response,options){var result=Ext.util.JSON.decode(response.responseText);this.fireEvent('metadata',result);}});},getBBox:function(layer){Ext.Ajax.request({url:Geo.UriTemplate.getUri('layer',layer+'/bbox'),method:'Get',headers:{'Content-Type':'text/json'},scope:this,success:function(response,options){var result=Ext.util.JSON.decode(response.responseText);this.fireEvent('bbox',result);}});},getStaticBBox:function(layer){Ext.Ajax.request({url:Geo.UriTemplate.getUri('layer',layer+'/staticbbox'),method:'Get',headers:{'Content-Type':'text/json'},scope:this,success:function(response,options){var result=Ext.util.JSON.decode(response.responseText);this.fireEvent('staticbbox',result);}});}});